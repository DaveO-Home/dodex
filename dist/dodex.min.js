!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).dodexBundle=t()}(this,(function(){"use strict";let e=null,t=null,r=0,o="",n=null,s=document.querySelector(".dodex--open"),d=null,a=null,c=null,l=!1,i=0,u=null,p=0,f=null,y=0,h=0,m=!1,b=null,x=null,g=0,v=0;const C=e=>{h=e-1,i=h,f.rollBack(a[h],h)},S=function(e){const t=document.body,r=document.documentElement;e.ctrlKey&&null!==f.mess?f.mess&&f.mess.popup(c,f,a):"none"!==f.private&&null!==f.input&&(null!==document.querySelector("#dodexInput")&&document.querySelector("#dodexInput").style&&"1"===document.querySelector("#dodexInput").style.opacity?(document.querySelector("#dodexInput").style.opacity="0",setTimeout((()=>{document.querySelector("#dodexInput").style.display="none"}),500),t.scrollTop=0,r.scrollTop=0):f.input&&(f.input(c,f,a),setTimeout((()=>{document.querySelector("#dodexInput").style.opacity="1"}),500),document.querySelector("#dodexInput").style.display="block"))},w=e=>{r=e.clientY,l=!0},A=()=>{y=0,l=!1},k=()=>{y=0,l=!1},P=t=>{l&&y>0&&y%8==0||(l&&void 0!==a[h]&&(h<u&&r<t.clientY?(26==h&&(h=27,i=h),f.rollAhead(a[h],h),h=r<t.clientY&&h<u-1?h+=1:h,y+=1):(26==h&&(h=25,i=h),h>-1&&(a[h].removeAttribute("style"),a[h].style.setProperty("top",e*h*-1+"px"),f.removeClass(a[h].querySelector(".face"),"remove-tab"),h=h>0?h-=1:0,y+=1,i=h,p=y))),r=t.clientY)},q=(e=>{switch(!0){case e.indexOf("edge")>-1:return"edge";case e.indexOf("opr")>-1&&!!window.opr:return"opera";case e.indexOf("chrome")>-1&&!!window.chrome:return"chrome";case e.indexOf("trident")>-1:return"ie";case e.indexOf("firefox")>-1:case"undefined"!=typeof InstallTrigger:return"firefox";case e.indexOf("safari")>-1:return"safari";case e.indexOf("YaBrowser")>-1:return"YaBrowser";default:return"other"}})(window.navigator.userAgent.toLowerCase()),E={init(e){return f=N,c=this,s||(s=document.querySelector(".dodex--open")),s.onmousedown=e=>{this.openDodex(e)},new Promise((t=>{f.setSize(e),f.setPosition(e),f.setPrivate(e),f.setComm(e),this.addContent(t)})).then((e=>{const t=document.querySelector(".top--dodex");return t&&t.style.setProperty("display","none"),e})).catch((e=>{throw`The widget doDex did not load correctly: ${e}`}))},addContent(e){o.match(/js$/i)?f.loadJs(o,e):o.match(/json$/i)?f.loadJson(o,e):N.addElements({},e)},setContentFile(e){o=e},addCard(e){if(u>52)return;var t;0===g&&void 0!==e&&e.cards&&(g=Object.keys?(t=e.cards,Object.keys(t).length):function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&++t;return t}(e.cards)),v+=1;const r=a.length+1,o=f.addBaseCard(r,n);if(f.addCardFrontFace(r,e,o),f.addCardBackFace(r,e,o),v===g&&"firefox"===q){const e=a.length;for(let t=0;t<e;t++)f.rollAhead(a[t],t);setTimeout((()=>{for(let t=e-1;t>=0;t--)C(t+1)}))}u+=1},openDodex(){const t=document.querySelector(".top--dodex");if(m)t.classList.add("minus-thousand"),f.removeClass(t,"plus-thousand"),t.style.setProperty("top",f.getTop(e)),setTimeout((()=>{t.style.setProperty("display","none")}),500),b&&t.style.setProperty("left",b),m=!1;else try{t.style.setProperty("display","block"),f.removeClass(t,"minus-thousand"),t.classList.add("plus-thousand"),t.style.setProperty("top",f.getTop(e)),b&&t.style.setProperty("left",b),m=!0}finally{}}},N={setSize(r){"object"==typeof r&&"number"==typeof r.width&&"number"==typeof r.height&&(e=r.height,t=r.width)},setPosition(e){"object"==typeof e&&"string"==typeof e.left&&"string"==typeof e.top&&e.left.includes("%")&&e.top.includes("px")&&("50%"!==e.left||"100px"!==e.top)&&(b=e.left,x=e.top)},setPrivate(e){this.private="none",this.replace=!1,this.input=null,"object"==typeof e&&(this.private=e.private||this.private,this.replace=e.replace||this.replace,this.input=e.input||this.input,"string"==typeof this.private&&"boolean"==typeof this.replace&&"function"==typeof this.input||this.input&&console.warn("Initialization parameters may be incorrect"))},setComm(e){this.handle="ace",this.server="localhost:3087",this.mess=null,"object"==typeof e&&(this.server=e.server||this.server,this.mess=e.mess||this.mess,"string"==typeof this.server&&"object"==typeof this.mess||this.mess&&console.warn("Initialization parameters may be incorrect"))},rollAhead(t,r){26!==(r=void 0!==r?r:h)&&((null===t.getAttribute("style")||t.getAttribute("style").indexOf("rotateX")<0)&&t.setAttribute("style",`opacity:1;transform: rotateX(-190deg); z-index:${r};/*top:${e*r*-1}px; transition: transform 1s cubic-bezier(.47,.03,.47,1);*/`),t.style.setProperty("top",e*r*-1+"px")),i=r,p=r+1},rollBack(t,r){26!=r&&(t.removeAttribute("style"),t.style.setProperty("top",e*r*-1+"px"))},removeClass(e,t,r){void 0!==r&&(e=document.querySelector(r));const o=new RegExp(`(?:^|\\s)${t}(?!\\S)`,"g");e.className=e.className.replace(o,"")},setDials(r){const o=t-70,s=e+175,d=e+75;n.setAttribute("style",`width:${t}px; height: ${e}px;`),r[0].setAttribute("style",`transform: translate(${o}px, ${s}px) rotate(90deg)`),r[1].setAttribute("style",`transform: translate(-100px, ${d}px) rotate(-90deg)`),r.forEach((e=>{e.onmousedown=w,e.onmouseup=A,e.onmouseout=k,e.onmousemove=P,e.ondblclick=S}))},currentClickedElement(e){const t=e&&e.target?e.target:null;let r;if(null===t)return null;t.className.split(" ").forEach((e=>{let t=e.indexOf("front")>-1?"front":e;switch(t=e.indexOf("back")>-1?"back":t,t){case"front":{let t=e.substring("front".length,e.length);if(isNaN(t))return;t=Number(t);const r=a[t-1].getAttribute("style"),o=t;if(r&&r.indexOf("z-index")>-1){for(let e=p;e>=o;e--)C(e);return}if("firefox"===q&&r&&r.indexOf("z-index")>-1)return;for(let e=i;e<t-1;e++)f.rollAhead(a[e],e);p=t,(e=>{h=e-1,i=h,f.rollAhead(a[h])})(t)}break;case"back":if(r=e.substring("back".length,e.length),isNaN(r))break;27!=r&&C(r)}}))},getStyleValue(e,t,r){let o=null;o="string"==typeof e?document.querySelector(e):e;const n=window.getComputedStyle(o);if(r){const e=n.getPropertyValue(t).replace(/[^\d]/g,"");try{if(isNaN(e))throw{message:"Style is not a Number"}}catch(t){console.error(t.message,e)}return Number(isNaN(e)?0:e)}return n},addElements(r,o){let s=document.querySelector("body"),l=document.createElement("div");this.createAttribute(l,"class","top--dodex"),s.appendChild(l),s=l,l=document.createElement("div"),this.createAttribute(l,"class","dodex"),s.appendChild(l),n=l,n.onmousedown=e=>{this.currentClickedElement(e,this)},e||t||(e=this.getStyleValue(n,"height",!0),t=this.getStyleValue(n,"width",!0)),n.style.setProperty("--cardwidth",t+"px"),n.style.setProperty("--cardheight",e+"px"),l=document.createElement("div"),this.createAttribute(l,"class","dial"),n.appendChild(l),l=document.createElement("div"),this.createAttribute(l,"class","dial"),n.appendChild(l),d=document.querySelectorAll(".dial"),this.setDials(d);for(let e=1;e<=27;e++){const t=f.addBaseCard(e,n);f.addCardFrontFace(e,r,t),f.addCardBackFace(e,r,t)}if(a=Array.prototype.slice.call(n.querySelectorAll(".card")),u=void 0!==a?a.length:0,"firefox"===q){const t=a.length;for(let e=0;e<t;e++)f.rollAhead(a[e],e);setTimeout((()=>{for(let e=t-1;e>=0;e--)C(e+1);a[26].classList.add("rotate-195"),a[26].style.setProperty("top",26*e*-1+"px")}))}else a[26].classList.add("rotate-195"),a[26].style.setProperty("top",26*e*-1+"px"),r.cards&&r.cards[27]&&l.insertAdjacentHTML("beforeend",r.cards.card27.back.content);T(c,a).then((function(){f.linkClickHandler(),a[26].ondblclick=S;const e=document.querySelector("body");"firefox"===q&&e.classList.add("dodex-body")})),o()},linkClickHandler(){document.querySelector(".dodex").querySelectorAll("a").forEach((e=>{e.onclick=e=>{c.openDodex(e)}}))},addBaseCard(t,r){const o=document.createElement("div");this.createAttribute(o,"class",`card card${t} speed`),r.appendChild(o);const n=document.querySelector(`.card.card${t}`);return o.style.setProperty("top",e*(t-1)*-1+"px"),n},addCardFrontFace(e,t,r){const o=document.createElement("div"),n=`front${e}`;this.createAttribute(o,"class",`${n} face shadow1 shaft`),r.appendChild(o);const s=`card${e}`;if(t.cards&&t.cards[s]){let r=$(t.cards[s].front.content);o.insertAdjacentHTML("beforeend",r),t.cards[s].front.content&&o.classList.add("green-tab");let n=t.cards[s].tab;n?(n=n.length>3?n.substring(0,3):n,o.style.setProperty("--tab",`"${n}"`)):o.style.setProperty("--tab",`"${e}"`)}else o.style.setProperty("--tab",`"${e}"`);return s},addCardBackFace(e,t,r){let o=String.fromCharCode(e+64);e>26&&(o="");const n=`card${e}`,s=document.createElement("div");if(this.createAttribute(s,"class",`back${e} face shadow2`),r.appendChild(s),this.addContent(s,o),t.cards&&t.cards[n]){var d=$(t.cards[n].back.content);s.insertAdjacentHTML("beforeend",d)}a&&a.push(r)},createAttribute(e,t,r){const o=document.createAttribute(t);o.value=r,e.setAttributeNode(o)},addContent(e,t){const r=document.createTextNode(t);e.appendChild(r)},getTop:e=>x||(e<220?100:e<300?150:e<500?300:e<700?500:600)+"px",loadJson(e,t){const r=new XMLHttpRequest;r.onreadystatechange=function(){if(404===this.status)throw`JSON file not found:${e}`;if(4===this.readyState&&200===this.status&&this.response)try{N.addElements(JSON.parse(this.response),t)}catch(e){console.error("Possible file not found: ",e),N.addElements({},t)}},r.open("GET",e),r.send()},loadJs(e,t){new Promise((r=>{let o=document.createElement("script");o.type="text/javascript",o.src=e,o.onload=()=>{"undefined"!=typeof dodexContent?N.addElements(dodexContent,t):N.addElements({},t),r()},o.onerror=()=>{N.addElements({},t),r()},document.head.appendChild(o)}))}};window.doDex=E;const T=function(e,t){return new Promise((function(r){indexedDB.open("dodex",2).onsuccess=function(o){const n=o.target.result;let s;try{s=n.transaction("cards","readonly")}catch(e){return n.close(),indexedDB.deleteDatabase("dodex"),void r()}var d=s.objectStore("cards").getAll();d.onsuccess=function(){const o=d.result.sort((function(e,t){return Number(e.idx.replace("card",""))>Number(t.idx.replace("card",""))?1:-1}));for(let r in o){const n=Number(o[r].idx.replace("card",""));!function(r,o){const n={cards:{}};n.cards=r,"append"===r.type&&o<t.length||o<=27||o<t.length?("replace"===r.type&&(document.querySelector(".front"+o).innerHTML="",document.querySelector(".back"+o).innerHTML=""),function(e,t,r,o){const n=o[r-1].querySelector(".front"+r),s=o[r-1].querySelector(".back"+r);let d;e.cards&&e.cards[t]&&(e.cards[t].front&&e.cards[t].front.content&&e.cards[t].front.content.length>0&&(d=$(e.cards[t].front.content),n.insertAdjacentHTML("beforeend",d),n.classList.add("green-tab")),e.cards[t].back&&e.cards[t].back.content&&e.cards[t].back.content.length>0&&(d=$(e.cards[t].back.content),s.insertAdjacentHTML("beforeend",d)))}(n,r.idx,o,t)):e.addCard(n)}(o[r],n)}n.close(),r()}}}))};function $(e){let t="",r={};if(null!=e||""!=e){let t=JSON.stringify(e);"["===t.trimLeft().substring(0,1)&&(r=JSON.parse(t))}if(r.constructor===Array)for(let e in r)t+=r[e]+" ";return""===t?e:t}return E}));